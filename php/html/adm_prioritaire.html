<!-- adm_prioritaire.html 
	@version : 1.0.3
	@date : 2020-10-16
-->

{include="adm_header"}

<body>
	<div class="container bg-light h-95">
	   
		{include="adm_navbar"}
	
		<div class="row h-100">
			<div class="col-sm-3">
				<div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
					{loop="$creneaux"}
					<a class="nav-link{$value.Active}{$value.Disabled}" id="v-tab-{$value.id_creneau}" data-toggle="pill" href="#v-pills-{$value.id_creneau}" role="tab" aria-controls="v-pills-{$value.id_creneau}" aria-selected="true" onmousedown='$("#id_creneau").val({$value.id_creneau});'>{$value.Salle} {$value.Jour} {$value.Heure_Debut} {$value.Nbr_Place}</a>
					{/loop}
				</div>
			</div>
			<div class="col">
				<nav class="navbar navbar-dark" style="background-color: #e3f2fd;">
					<form class="form-inline my-2 my-lg-0 ml-auto" id="id_form_find_prioritaire">					
      					<div class="input-group">

      						<div class="input-group-prepend">
        						<span class="input-group-text" id="basic-addon1"><i class="fas fa-search"></i></span>
      						</div>
      						
      						<input class="form-control mr-sm-2" type="text" name="LicNom" placeholder="N° licence où Nom" aria-label="Search" aria-describedby="basic-addon1" required />
      						
							<button class="btn btn-outline-primary btn-md my-2 my-sm-0 ml-3" type="submit"><i class="fas fa-user-lock" title="Ajouter un prioritaire"></i> Ajouter un prioritaire</button>
      					</div>
      					<input type="hidden" name="id_creneau" id="id_creneau" value="{$id_creneau}"/>
    				</form>
				</nav>
				
				<div class="tab-content" id="v-pills-tabContent">				 
					{loop="$creneaux"}
					<div class="tab-pane fade{$value.ShowActive}" id="v-pills-{$value.id_creneau}" role="tabpanel" aria-labelledby="v-pills-{$value.id_creneau}">
						<table class="table table-striped table-bordered table-hover table-hover-color">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Licence</th>
									<th scope="col">Nom</th>
									<th scope="col">Prenom</th>
									<th scope="col">Supp.</th>
								</tr>
							</thead>
							<tbody>
								{loop="$value.Licenciers"}
								<tr>
									<th scope="row">{$value.num}</th>
									<td>{$value.id_licencier}</td>
									<td>{$value.Nom}</td>
									<td>{$value.Prenom}</td>
									<td><button onclick="DelPrioritaire({$value.id_prioritaire})"><i class="far fa-trash-alt"></i></button></td>
								</tr>
								{/loop}
							</tbody>
						</table>
					</div>
					{/loop}
				</div>
			</div>
		</div>
		<br />
	</div>
</body>

<script>
$(document).ready(
	function() {
		// this is the id of the form
		$("#id_form_find_prioritaire").submit(function(e) {
		    e.preventDefault(); // avoid to execute the actual submit of the form.
		    var form = $(this);
		    			    
		    $.ajax({
				type: "GET",
				url: "admin.php?page=find_prioritaire",
				data: form.serialize(), // serializes the form's elements.
				success: function(response) { 
					var data = $.parseJSON(response);
					
					$.alert({
						columnClass: 'medium',
					    title: data.title,
					    content: data.content
					});
	
					// Rechargement des données
					location.reload();
	           }
		    })    
		});
		
		// Modification du champ id_creneau caché en fonction de l'onglet actif
		{loop="$creneaux"}
		$('#v-tab-{$value.id_creneau}').click(function(){ 
			$('#id_creneau').val({$value.id_creneau});
			// Send Ajax request to backend.php, with src set as "img" in the POST data
		    $.ajax({
				type: "GET",
				url: "admin.php?page=save_idCreneau&idCreneau={$value.id_creneau}"
		    })
		});
		{/loop}
);
	
// Suppression d'un prioritaire
function DelPrioritaire(id_prioritaire) {    
    $.ajax({
       type: "GET",
       url: "admin.php?page=delete_prioritaire",	
       dataType : 'json',
       data: { id_prioritaire: id_prioritaire},
       success: function(response) {     	   	
			$.alert({
				columnClass: 'medium',
			    title: 'Enregistrement supprimé !',
			    content: "Le licencié n'est plus prioritaire sur ce créneau."
			});
					
			// Rechargement de la page
        	location.reload();
       }
    })
}
</script>
</html>	